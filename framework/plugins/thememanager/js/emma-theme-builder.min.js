/***

  EmmaActive Theme Builder
  http://www.emmaactive.com
  @copyright: Copyright (c) 2011 EmmaActive, Inc. All rights reserved.
  @date: 2012-01-06

***/
var allowServerUpdate=!0,pubKey,globalSettingsObject,themeBuilder={init:function(a,b){pubKey=a;globalSettingsObject=$.extend(!0,{},b);$("#buildCustomTheme").trigger("click")}},lib={isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}},fn={gradients:{merge:function(a){if(this.canvas&&this.canvas.theme&&this.canvas.theme[a[0]]&&this.canvas.theme[a[1]])this.canvas.theme.backgroundColor="0-"+this.canvas.theme[a[0]]+" 1-"+this.canvas.theme[a[1]],delete this.canvas.theme[a[0]],delete this.canvas.theme[a[1]];
return this},expand:function(a,b){var c,d;if(this.canvas&&this.canvas.theme&&this.canvas.theme.backgroundColor&&this.canvas.theme.backgroundStyle===a){c=this.canvas.theme.backgroundColor.split(" ");for(d=0;d<c.length;d+=1)this.canvas.theme[b[d]]=c[d].split("-")[1];delete this.canvas.theme.backgroundColor}return this}},ajax:function(a,b,c){$("#ajaxNotifier").addClass("active");$.post("plugins/thememanager/php/ajax/"+a+".ajax.php",b,function(a){c&&c(a);$("#ajaxNotifier").removeClass("active")})}};
(function(a){a.fn.disableFormElements=function(){return this.each(function(){a(this).prop("disabled","disabled")})};a.fn.enableFormElements=function(){return this.each(function(){a(this).removeProp("disabled")})};a.fn.numberSpinner=function(){return this.each(function(){var b=a(this).find(".spinInput"),c=b.attr("minValue")||0,d=b.attr("maxValue")||100,f=a(this).find(".spinUp"),g=a(this).find(".spinDown"),e=function(a){b.val(a);window.clearTimeout(b.timeoutID);b.timeoutID=window.setTimeout(function(){b.trigger("change")},
500)};f.click(function(){var a=parseInt(b.val(),10);e(a<d?a+1:d);return!1});g.click(function(){var a=parseInt(b.val(),10);e(a>c?a-1:c);return!1});b.keyup(function(){var a=parseInt(b.val(),10),a=isNaN(a)?0:a>d?d:a<c?c:a;e(a)})})};a.fn.boxDropDown=function(){return this.each(function(){var b=a(this),c=b.find(".dropdownWrapper");c.find(".selected-thumbnail").click(function(){c.toggleClass("active")});c.find(".dropdown-option").click(function(){var d=a(this).find(".thumbnail").attr("src");a(this).addClass("selected").siblings().removeClass("selected");
c.removeClass("active").find(".selected-thumbnail > .thumbnail").attr("src",d);b.find(".dropdown-value").val(d).trigger("change")}).eq(0).trigger("click")})}})(jQuery);function toggleContainer(){var a="#"+$(this).attr("toggleContainer");$(this).is(":checked")?$(a).show().find(":input").enableFormElements():$(a).hide().find(":input").disableFormElements()}
function changeBackgroundStyle(){$(".backgroundStyle-option").hide().find(":input").disableFormElements();$("#backgroundStyle-"+$(this).val()+"-option").show().find(":input").enableFormElements()}
function updateFormValues(a,b){var c=this,d=$.extend(!0,{},a),f=[],g=function(a,b){$.each(a,function(a,d){var e,i;e=b?b+"."+a:a;"object"===$.type(d)?g(d,e):(e=$("[name='"+e+"']",c),0<e.length&&("boolean"===$.type(d)?(i=e.is(":checked"),!0===d&&!i?(e.prop("checked",!0),f.push(e)):!1===d&&i&&(e.prop("checked",!1),f.push(e))):e.val(d)))})},d=fn.gradients.expand.call(d,"linear",["linearGradient1","linearGradient2"]),d=fn.gradients.expand.call(d,"radial",["radialGradient1","radialGradient2"]);g(d);$.each(f,
function(a,c){allowServerUpdate=!1;c.iphoneStyle("refresh");allowServerUpdate=!0});$("[toggleContainer]",c).each(toggleContainer);$("#backgroundStyle",c).each(changeBackgroundStyle);$.each(b,function(a,b){"#"===b.charAt(0)?c[0].elements[a].color.fromString(b):"http"===b.slice(0,4)?(allowServerUpdate=!1,$("[name='"+a+"']",c).siblings(".dropdownWrapper").find(".dropdown-options").find("[src='"+b+"']").parent().trigger("click"),allowServerUpdate=!0):$("[name='"+a+"']",c).val(b)})}
function updateServerValues(){var a=$(this).find("[method='js']").find(":input:not(:disabled)"),b=$(this).find("[method='css']").find(":input:not(:disabled)"),c={},d={},f=function(a,b){var c=a.shift();0<a.length?(this[c]=this.hasOwnProperty(c)?this[c]:{},f.call(this[c],a,b)):this[c]=b};allowServerUpdate&&($.each(a,function(){var a=$(this),b=a.attr("type"),d=a.attr("name"),h=a.val();d&&(a="checkbox"===b?a.is(":checked"):lib.isNumeric(h)?parseFloat(h):h,f.call(c,d.split("."),a))}),c=fn.gradients.merge.call(c,
["linearGradient1","linearGradient2"]),c=fn.gradients.merge.call(c,["radialGradient1","radialGradient2"]),fn.ajax("setSiteSettings",{pk:pubKey,settings:c}),$.each(b,function(){var a=$(this),b=a.attr("name"),a=a.val();b&&(d[b]=a)}),fn.ajax("getCssFile",{pk:pubKey},function(a){a=a.split(".")[0];if(lib.isNumeric(a))d.wrapperIndex=a,$("#EMMA_active").addClass("EMMA_"+a),fn.ajax("setThemeCss",d)}))}
$(document).ready(function(){var a=$("#settings"),b=$("#emmaThemePreset"),c=$("#emmaThemeCustom"),d;$("#frontendResourceFiles",a).html(function(){var a="";$.each(frontendResourceFiles,function(b,c){a+='<li class="dropdown-option"><span class="dropdown-thumbnail"><img class="thumbnail" src="'+c+'" /></span></li>'});return a});$("#themePresetButtons").html(function(){var a="";$.each(frontendResourceFiles,function(b){a+='<button class="btn-load-theme" type="button" name="'+b+'"><span class="checkbox"></span><img src="plugins/thememanager/thumbs/'+
b+'.jpg" /></button>'});return a});d=b.find(".btn-load-theme");$("[toggleContainer]",a).change(toggleContainer).each(toggleContainer);$("#backgroundStyle",a).change(changeBackgroundStyle).each(changeBackgroundStyle);$(".number",a).numberSpinner();$(".divbox-dropdown",a).boxDropDown();$(".iphoneStyle",a).iphoneStyle({onChange:function(a){a.trigger("change")}});b.hide();c.hide();d.click(function(){var b=$(this).attr("name");$(this).addClass("active").siblings().removeClass("active");globalSettingsObject=
$.extend(!0,{},defaultThemeJs[b]);updateFormValues.call(a,globalSettingsObject,defaultThemeCss[b]);a.each(updateServerValues)});$("#selectPresetTheme").click(function(){$(this).addClass("active").siblings().removeClass("active");if(!0===b.prop("hasFocus"))return!1;c.removeProp("hasFocus");b.prop("hasFocus",!0);c.hide();b.show();return!1});$("#buildCustomTheme").click(function(){$(this).addClass("active").siblings().removeClass("active");if(!0===c.prop("hasFocus"))return!1;b.removeProp("hasFocus");
c.prop("hasFocus",!0);b.hide();c.show();fn.ajax("getThemeCss",{themeFile:globalSettingsObject.themeFile},function(b){updateFormValues.call(a,globalSettingsObject,b)});return!1});a.change(updateServerValues)});